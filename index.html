<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IdolVerse ‚Ä¢ Photocards</title>

<style>
:root {
  --bg-dark-deep: #1c1c3a;
  --bg-gradient: linear-gradient(135deg, #1e1e2f, #3a3a6a);
  --card-purple: #2b2b4f;
  --primary-pink: #ff4fd8;
  --text-white: #ffffff;
  --violet-deep: #2d1b4d;
  --violet-accent: #8a2be2;
  --success-green: #2ecc71;
}

/* NOVOS ESTILOS - TEMAS (4) */
body.tema-bts { --primary-pink: #a020f0; --bg-gradient: linear-gradient(135deg, #1a0b2e, #4b0082); }
body.tema-bp { --primary-pink: #f8a5c2; --bg-gradient: linear-gradient(135deg, #000000, #333333); }
body.tema-nj { --primary-pink: #00d2ff; --bg-gradient: linear-gradient(135deg, #1e3c72, #2a5298); }

.theme-selector {
    position: fixed; left: 10px; bottom: 20px; z-index: 1100;
    display: flex; flex-direction: column; gap: 10px;
}
.theme-dot {
    width: 25px; height: 25px; border-radius: 50%; border: 2px solid white; cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: var(--bg-gradient);
  background-attachment: fixed;
  color: var(--text-white);
  transition: all 0.5s ease;
}

/* ESTILOS DESTAQUES (2) */
.highlights-section { margin-top: 20px; padding: 0 10px; }
.highlights-title { font-size: 14px; text-transform: uppercase; letter-spacing: 2px; color: var(--primary-pink); margin-bottom: 10px; display: block; font-weight: bold; }
.highlights-scroll { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; scrollbar-width: none; }
.highlights-scroll::-webkit-scrollbar { display: none; }
.high-item { min-width: 140px; height: 140px; border-radius: 15px; position: relative; overflow: hidden; border: 2px solid var(--primary-pink); flex-shrink: 0; }
.high-item img { width: 100%; height: 100%; object-fit: cover; }
.high-label { position: absolute; bottom: 0; background: rgba(0,0,0,0.7); width: 100%; font-size: 10px; text-align: center; padding: 5px; }

header {
  background: var(--bg-dark-deep);
  padding: 10px 15px 5px 15px;
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.header-top { display: flex; align-items: center; gap: 12px; width: 100%; }
.logo-container { cursor: pointer; flex-shrink: 0; }
.logo-img { height: 35px; width: auto; object-fit: contain; }

.search-container { flex-grow: 1; position: relative; }
.search-container input {
  width: 100%;
  padding: 10px 12px 10px 38px;
  border-radius: 25px;
  border: none;
  background: #ffffff;
  color: #333;
  font-size: 14px;
}

.search-container::before {
  content: 'üîç';
  position: absolute;
  left: 12px; top: 50%; transform: translateY(-50%);
  font-size: 14px; opacity: 0.5;
}

.location-bar {
  display: flex; align-items: center;
  font-size: 11px; color: rgba(255, 255, 255, 0.7);
  padding: 2px 0;
}

.nav-menu {
  display: flex; overflow-x: auto; white-space: nowrap;
  gap: 20px; padding: 8px 0; scrollbar-width: none;
}
.nav-menu::-webkit-scrollbar { display: none; }

.nav-item {
  color: var(--text-white); text-decoration: none;
  font-size: 13px; font-weight: 500; opacity: 0.8;
  padding-bottom: 5px;
  cursor: pointer;
}
.nav-item.active { border-bottom: 2px solid var(--primary-pink); opacity: 1; }

#cartBtn { 
  position: fixed; 
  bottom: 20px; 
  right: 20px; 
  background: var(--primary-pink); 
  border: none; 
  width: 60px; 
  height: 60px; 
  border-radius: 50%; 
  z-index: 1100; 
  color: white; 
  cursor: pointer; 
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
  font-size: 24px;
}

#cartCount {
  position: absolute; top: 5px; right: 5px;
  background: white; color: var(--primary-pink);
  font-size: 12px; width: 20px; height: 20px;
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-weight: bold;
}

.container { max-width: 1200px; margin: 0 auto; padding: 10px; position: relative; }
.products {
  display: grid; grid-template-columns: repeat(2, 1fr);
  gap: 15px; margin-top: 20px;
}
@media (min-width: 768px) { .products { grid-template-columns: repeat(4, 1fr); } }

.card {
  background: var(--card-purple); border-radius: 12px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column;
  transition: transform 0.3s ease; position: relative;
}
.card:hover { transform: translateY(-5px); border-color: var(--primary-pink); }

/* ESTILO ESCASSEZ (3) */
.badge-scarcity {
    position: absolute; bottom: 10px; left: 10px;
    background: rgba(255, 0, 0, 0.8); color: white;
    font-size: 9px; padding: 3px 8px; border-radius: 4px;
    font-weight: bold; z-index: 5;
}
.viewing-now {
    font-size: 9px; color: #ffeb3b; margin-top: 5px;
    display: flex; align-items: center; justify-content: center; gap: 3px;
}

.img-container { width: 100%; height: 180px; overflow: hidden; cursor: pointer; position: relative; }
.card img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
.card-info { padding: 10px; text-align: center; flex-grow: 1; }
.card-info h3 { font-size: 14px; margin: 5px 0; cursor: pointer; }
.price { color: #ffb3f0; font-size: 16px; font-weight: bold; }

.card-actions {
    position: absolute; top: 10px; right: 10px;
    display: flex; flex-direction: column; gap: 8px; z-index: 5;
}
.action-btn {
    background: rgba(0,0,0,0.5); color: white; border: none;
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 14px; backdrop-filter: blur(4px);
    transition: 0.3s;
}
.action-btn:hover { background: var(--primary-pink); }
.fav-active { color: #ff4fd8; }

.btn-details { background: transparent; color: var(--primary-pink); border: none; cursor: pointer; text-decoration: underline; font-size: 11px; margin-bottom: 5px; }
.description-text { display: none; font-size: 10px; text-align: left; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; margin-bottom: 8px; color: #ddd; line-height: 1.4; }

.btn-buy { background: var(--primary-pink); color: white; border: none; padding: 8px; border-radius: 20px; width: 100%; font-weight: bold; cursor: pointer; font-size: 12px; }

#productPage {
    position: fixed; inset: 0; background: var(--bg-dark-deep);
    z-index: 2500; display: none; flex-direction: column;
    overflow-y: auto; animation: ppSlideUp 0.4s ease;
}
@keyframes ppSlideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

.pp-header { position: sticky; top: 0; background: var(--bg-dark-deep); padding: 15px; display: flex; align-items: center; z-index: 10; border-bottom: 1px solid rgba(255,255,255,0.1); }
.pp-back { background: none; border: none; color: white; font-size: 24px; cursor: pointer; margin-right: 15px; }

.pp-carousel-container { width: 100%; position: relative; background: #000; }
.pp-carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; }
.pp-carousel::-webkit-scrollbar { display: none; }
.pp-carousel img { min-width: 100%; aspect-ratio: 1/1; object-fit: cover; scroll-snap-align: start; }

.pp-dots { position: absolute; bottom: 15px; width: 100%; display: flex; justify-content: center; gap: 8px; }
.pp-dot { width: 8px; height: 8px; background: rgba(255,255,255,0.4); border-radius: 50%; }
.pp-dot.active { background: var(--primary-pink); width: 18px; border-radius: 10px; }

.pp-content { padding: 20px; }
.pp-title { font-size: 22px; font-weight: bold; margin-bottom: 8px; }
.pp-price-box { margin-bottom: 20px; }
.pp-main-price { font-size: 26px; color: var(--primary-pink); font-weight: bold; }
.pp-installments { font-size: 13px; opacity: 0.7; display: block; }

.quality-badges { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
.badge { background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 5px; font-size: 10px; display: flex; align-items: center; gap: 5px; border: 1px solid rgba(255,255,255,0.05); }

.pp-label { display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin: 20px 0 10px; color: #aaa; }
.pp-vars { display: flex; gap: 10px; margin-bottom: 20px; }
.v-opt { padding: 8px 15px; border: 1px solid #444; border-radius: 8px; font-size: 13px; cursor: pointer; }
.v-opt.active { border-color: var(--primary-pink); background: rgba(255,79,216,0.1); color: var(--primary-pink); }

.pp-qty { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; background: rgba(255,255,255,0.05); width: fit-content; padding: 5px 15px; border-radius: 30px; }
.pp-qty button { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px 10px; }

.pp-blocks { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 30px; }
.pp-info-block { padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
.pp-info-block h4 { display: flex; align-items: center; gap: 10px; margin: 0 0 10px 0; color: #eee; }
.pp-info-block p { font-size: 14px; color: #bbb; line-height: 1.6; margin: 0; }

#toast {
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    background: var(--success-green); color: white; padding: 12px 25px;
    border-radius: 30px; font-weight: bold; font-size: 14px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 5000;
    display: none; animation: toastFade 0.3s ease;
}
@keyframes toastFade { from { top: -50px; opacity: 0; } to { top: 20px; opacity: 1; } }

.custom-order-section {
    background: rgba(255, 79, 216, 0.1); border: 1px solid var(--primary-pink);
    border-radius: 15px; padding: 20px; margin: 20px 0; text-align: center;
}
.btn-whatsapp-custom {
    display: inline-block; background: #25d366; color: white;
    text-decoration: none; padding: 10px 20px; border-radius: 50px;
    font-weight: bold; font-size: 12px; margin-top: 10px;
}

.meus-pedidos { background: rgba(0,0,0,0.2); margin: 30px 0; padding: 20px; border-radius: 15px; border: 1px dashed var(--primary-pink); }
.pedido-item {
    background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-top: 10px;
    border-left: 4px solid var(--primary-pink); font-size: 13px;
}

#carrinho { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100vh; background: var(--violet-deep); z-index: 2000; transition: 0.4s; display: flex; flex-direction: column; box-shadow: -5px 0 20px rgba(0,0,0,0.8); }
.cart-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); }
#listaCarrinho { flex: 1; overflow-y: auto; padding: 15px; }

.item-cart { display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 10px; }
.item-cart img { width: 60px; height: 60px; border-radius: 5px; object-fit: cover; }

.cart-footer { padding: 15px; background: var(--bg-dark-deep); border-top: 1px solid var(--primary-pink); overflow-y: auto; padding-bottom: 30px; }
.cart-inputs input { width: 100%; background: #1c1c3a; border: 1px solid #444; color: white; padding: 10px; border-radius: 8px; font-size: 13px; margin-bottom: 8px; }

.main-footer { background: #111; padding: 40px 20px; margin-top: 50px; border-top: 3px solid var(--primary-pink); }
.footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto; }
.footer-col h4 { color: var(--primary-pink); margin-bottom: 15px; font-size: 16px; }

#overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; z-index: 1500; }
#zoomModal { display: none; position: fixed; z-index: 3000; inset: 0; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; }
#imgZoomed { max-width: 90%; max-height: 80%; border-radius: 10px; }

.credits { text-align: center; padding: 20px 0; margin-top: 0; font-size: 10px; letter-spacing: 1px; color: rgba(255, 255, 255, 0.3); background: #000; text-transform: uppercase; }
.credits span { color: var(--primary-pink); opacity: 0.5; }
</style>
</head>
<body onload="carregarTudo()">

<div class="theme-selector">
    <div class="theme-dot" style="background:#ff4fd8" onclick="mudarTema('')" title="Padr√£o"></div>
    <div class="theme-dot" style="background:#a020f0" onclick="mudarTema('tema-bts')" title="BTS"></div>
    <div class="theme-dot" style="background:#000" onclick="mudarTema('tema-bp')" title="Blackpink"></div>
    <div class="theme-dot" style="background:#00d2ff" onclick="mudarTema('tema-nj')" title="NewJeans"></div>
</div>

<div id="toast">‚úÖ Adicionado ao carrinho!</div>
<div id="zoomModal" onclick="this.style.display='none'"><img id="imgZoomed" src=""></div>

<div id="productPage">
    <div class="pp-header">
        <button class="pp-back" onclick="fecharPP()">‚úï</button>
        <span style="font-weight: bold; font-size: 14px;">IdolVerse Store</span>
    </div>
    <div class="pp-carousel-container">
        <div class="pp-carousel" id="ppSlider" onscroll="updateDots()"></div>
        <div class="pp-dots" id="ppDots"></div>
    </div>
    <div class="pp-content">
        <h1 class="pp-title" id="ppTitle">Nome</h1>
        <div class="pp-price-box">
            <span class="pp-main-price" id="ppPrice">R$ 0,00</span>
            <span class="pp-installments">ou em at√© 3x de <span id="ppParcela">R$ 0,00</span> sem juros</span>
        </div>
        <div class="quality-badges">
            <div class="badge">üíé Premium 300g</div>
            <div class="badge">‚òÄÔ∏è Prote√ß√£o UV</div>
            <div class="badge">‚úÇÔ∏è Cantos Redondos</div>
        </div>
        <label class="pp-label">Acabamento</label>
        <div class="pp-vars">
            <div class="v-opt active" onclick="selectV(this)">Brilhante</div>
            <div class="v-opt" onclick="selectV(this)">Fosco</div>
        </div>
        <label class="pp-label">Quantidade</label>
        <div class="pp-qty">
            <button onclick="mudarPPQty(-1)">-</button>
            <span id="ppQty">1</span>
            <button onclick="mudarPPQty(1)">+</button>
        </div>
        <button class="btn-buy" id="ppBuyBtn" style="padding: 18px; font-size: 15px;">ADICIONAR AO CARRINHO</button>
        <div class="pp-blocks">
            <div class="pp-info-block">
                <h4>‚ú® Descri√ß√£o Premium</h4>
                <p id="ppDesc">Texto da descri√ß√£o...</p>
            </div>
        </div>
    </div>
</div>

<header>
  <div class="header-top">
    <div class="logo-container"><img src="logo-img.png" alt="Logo" class="logo-img"></div>
    <div class="search-container"><input type="text" placeholder="Buscar no IdolVerse" onkeyup="buscar(this.value)"></div>
  </div>
  <div class="location-bar">
      <span id="welcomeMsg" style="margin-right: 10px; font-weight: bold; color: var(--primary-pink);"></span>
      <span id="displayEndereco">üìç Informe o endere√ßo no carrinho ></span>
  </div>
  <nav class="nav-menu">
    <a class="nav-item active" onclick="filtrarCategoria(this, '')">Todos</a>
    <a class="nav-item" onclick="filtrarCategoria(this, 'kpop')">K-pop</a>
    <a class="nav-item" onclick="filtrarCategoria(this, 'anime')">Anime</a>
    <a class="nav-item" onclick="filtrarCategoria(this, 'famosos')">Famosos</a>
    <a class="nav-item" onclick="filtrarCategoria(this, 'filmes')">Filmes</a>
    <a class="nav-item" onclick="filtrarFavoritos(this)">‚ù§Ô∏è Favoritos</a>
  </nav>
</header>

<div class="container">

  <div class="highlights-section">
      <span class="highlights-title">üî• Destaques da Semana</span>
      <div class="highlights-scroll">
          <div class="high-item" onclick="abrirPP('Kit BTS', 19.90, 'bts1.jpg', 'Especial BTS')"><img src="bts1.jpg"><div class="high-label">Mais Vendido</div></div>
          <div class="high-item" onclick="abrirPP('Pack BLACKPINK', 21.90, 'blackpink.jpg', 'Especial BP')"><img src="blackpink.jpg"><div class="high-label">Edi√ß√£o Limitada</div></div>
          <div class="high-item" onclick="abrirPP('Kit New Jeans', 24.90, 'newjeans.jpg', 'Especial NJ')"><img src="newjeans.jpg"><div class="high-label">Tend√™ncia</div></div>
          <div class="high-item" onclick="abrirPP('Kit Taylor Swift', 26.90, 'taylor.jpg', 'Especial TS')"><img src="taylor.jpg"><div class="high-label">Premium</div></div>
      </div>
  </div>

  <div class="products" id="productGrid">
    <div class="card produto" data-name="bts kpop">
      <div class="card-actions">
          <button class="action-btn" onclick="toggleFavorito(this, 'Kit BTS')">‚ù§Ô∏è</button>
          <button class="action-btn" onclick="compartilharProduto('Kit BTS')">üîó</button>
      </div>
      <div class="img-container">
          <img src="bts1.jpg">
          <div class="badge-scarcity">üî• APENAS 3 RESTANTES</div>
      </div>
      <div class="card-info">
          <h3>Kit BTS</h3>
          <p class="price">R$ 19,90</p>
          <div class="viewing-now">üëÅÔ∏è 14 pessoas vendo agora</div>
          <button class="btn-details" onclick="toggleDesc(this)">Ver detalhes</button>
          <div class="description-text">54 photocards lomo de alta qualidade.</div>
          <button class="btn-buy" onclick="addCarrinho('Kit BTS', 19.90, 'bts1.jpg')">Adicionar</button>
      </div>
    </div>

    <div class="card produto" data-name="blackpink kpop">
        <div class="card-actions">
            <button class="action-btn" onclick="toggleFavorito(this, 'Pack BLACKPINK')">‚ù§Ô∏è</button>
            <button class="action-btn" onclick="compartilharProduto('Pack BLACKPINK')">üîó</button>
        </div>
      <div class="img-container">
          <img src="blackpink.jpg">
          <div class="badge-scarcity">üíé EDI√á√ÉO RARA</div>
      </div>
      <div class="card-info">
          <h3>Pack BLACKPINK</h3>
          <p class="price">R$ 21,90</p>
          <div class="viewing-now">üëÅÔ∏è 8 pessoas vendo agora</div>
          <button class="btn-details" onclick="toggleDesc(this)">Ver detalhes</button>
          <div class="description-text">54 photocards lomo exclusivos.</div>
          <button class="btn-buy" onclick="addCarrinho('Pack BLACKPINK', 21.90, 'blackpink.jpg')">Adicionar</button>
      </div>
    </div>
    
    </div>

  <div class="custom-order-section">
      <h3>‚ú® Encomendas Personalizadas</h3>
      <p>Produzimos fanbox e caixas de photocards personalizadas üíñ.</p>
      <a href="https://wa.me/5591986122614" class="btn-whatsapp-custom">CHAMAR NO WHATSAPP</a>
  </div>

  <div class="meus-pedidos">
    <h3>üìã Pedidos em Andamento</h3>
    <div id="listaPedidosCliente">Nenhum pedido recente.</div>
    <button class="btn-limpar-pedidos" onclick="limparHistorico()" id="btnLimpar" style="display:none;">Limpar Hist√≥rico</button>
  </div>
</div>

<footer class="main-footer">
    <div class="footer-grid">
        <div class="footer-col">
            <h4>Institucional</h4>
            <a href="#">Sobre a IdolVerse</a>
            <a href="#">Prazo de Produ√ß√£o</a>
        </div>
        <div class="footer-col">
            <h4>Suporte</h4>
            <a href="https://wa.me/5591986122614">WhatsApp de Vendas</a>
        </div>
    </div>
    <div class="bug-report-footer" style="text-align: center; margin-top: 30px; font-size: 10px; color: #666;">
        Se encontrar algum bug no site, entre em contato com <a href="https://wa.me/559188822874">+55 91 8882-2874</a>.
    </div>
</footer>

<div class="credits">Criado por <span>Thiago Maksuel</span> ‚Ä¢ <span>Marina Angels</span> ‚Ä¢ <span>Maria Sophya</span></div>

<button id="cartBtn" onclick="toggleCarrinho()">üõí <span id="cartCount">0</span></button>
<div id="overlay" onclick="toggleCarrinho()"></div>

<div id="carrinho">
  <div class="cart-header">
    <h3>Meu Carrinho</h3>
    <span onclick="toggleCarrinho()" style="cursor:pointer; font-size:32px; padding: 10px; color: var(--primary-pink); font-weight: bold;">&times;</span>
  </div>
  <div id="listaCarrinho"></div>
  <div class="cart-footer">
    <div class="cart-inputs">
        <input type="text" id="cartNome" placeholder="Seu Nome" oninput="salvarDadosCliente()">
        <input type="text" id="cartEndereco" placeholder="Endere√ßo" oninput="salvarDadosCliente(); atualizarHeader()">
        <input type="text" id="cartCEP" placeholder="CEP" oninput="salvarDadosCliente()">
        <button onclick="calcularFrete()" style="width:100%; background:var(--violet-accent); color:white; border:none; padding:12px; border-radius:8px; margin-bottom:10px; cursor:pointer; font-weight: bold;">CALCULAR FRETE</button>
    </div>
    <div id="opcoesFrete" style="display:none; color:white; font-size:13px; margin-bottom:10px;">
        <label><input type="radio" name="tipoFrete" value="PAC" onchange="atualizarTotal()"> <span id="labelPAC">PAC</span></label>
        <label style="margin-left:15px;"><input type="radio" name="tipoFrete" value="SEDEX" checked onchange="atualizarTotal()"> <span id="labelSEDEX">SEDEX</span></label>
    </div>
    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:20px; margin: 10px 0;">
        <span>Total:</span><span id="total">R$ 0,00</span>
    </div>
    <button class="btn-buy" style="padding:18px; margin-top:10px; font-size: 14px;" onclick="finalizar()">FINALIZAR NO WHATSAPP</button>
  </div>
</div>

<script>
let carrinho = [];
let favoritos = JSON.parse(localStorage.getItem('idolverse_favs')) || [];
let valorFrete = 0;
let subtotalProdutos = 0;
let prazoEntrega = "";

// FUN√á√ÉO MUDAR TEMA (4)
function mudarTema(tema) {
    document.body.className = tema;
    localStorage.setItem('idolverse_tema', tema);
}

function carregarTudo() {
    carregarPedidosHist();
    carregarCarrinhoLocal();
    carregarDadosCliente();
    initProductClicks();
    sincronizarFavoritosUI();
    const temaSalvo = localStorage.getItem('idolverse_tema');
    if(temaSalvo) mudarTema(temaSalvo);
}

function toggleFavorito(btn, nome) {
    const index = favoritos.indexOf(nome);
    if(index === -1) {
        favoritos.push(nome);
        btn.classList.add('fav-active');
        showToast("‚ù§Ô∏è Adicionado aos favoritos!");
    } else {
        favoritos.splice(index, 1);
        btn.classList.remove('fav-active');
    }
    localStorage.setItem('idolverse_favs', JSON.stringify(favoritos));
}

function sincronizarFavoritosUI() {
    document.querySelectorAll('.card.produto').forEach(card => {
        const h3 = card.querySelector('h3');
        if(h3 && favoritos.includes(h3.innerText)) {
            const btn = card.querySelector('.action-btn');
            if(btn) btn.classList.add('fav-active');
        }
    });
}

function compartilharProduto(nome) {
    const texto = `Olha esse kit da IdolVerse: ${nome}! ‚ú®üíñ\nVeja aqui: ${window.location.href}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(texto)}`, '_blank');
}

function salvarDadosCliente() {
    const dados = {
        nome: document.getElementById("cartNome").value,
        endereco: document.getElementById("cartEndereco").value,
        cep: document.getElementById("cartCEP").value
    };
    localStorage.setItem('idolverse_cliente', JSON.stringify(dados));
    if(dados.nome) document.getElementById("welcomeMsg").innerText = `Oi, ${dados.nome.split(' ')[0]}! ‚ú®`;
}

function carregarDadosCliente() {
    const salvo = localStorage.getItem('idolverse_cliente');
    if(salvo) {
        const d = JSON.parse(salvo);
        document.getElementById("cartNome").value = d.nome || "";
        document.getElementById("cartEndereco").value = d.endereco || "";
        document.getElementById("cartCEP").value = d.cep || "";
        if(d.nome) document.getElementById("welcomeMsg").innerText = `Oi, ${d.nome.split(' ')[0]}! ‚ú®`;
    }
}

function initProductClicks() {
    document.querySelectorAll('.card.produto').forEach(card => {
        const img = card.querySelector('img');
        const h3 = card.querySelector('h3');
        if(img && h3) {
            const openFunc = () => {
                const precoStr = card.querySelector('.price').innerText;
                const preco = parseFloat(precoStr.replace('R$', '').replace(',', '.'));
                abrirPP(h3.innerText, preco, img.src, card.querySelector('.description-text').innerText);
            };
            img.onclick = openFunc;
            h3.onclick = openFunc;
        }
    });
}

function abrirPP(nome, preco, img, desc) {
    document.getElementById("ppTitle").innerText = nome;
    document.getElementById("ppPrice").innerText = `R$ ${preco.toFixed(2).replace('.', ',')}`;
    document.getElementById("ppParcela").innerText = `R$ ${(preco/3).toFixed(2).replace('.', ',')}`;
    document.getElementById("ppDesc").innerText = desc;
    const slider = document.getElementById("ppSlider");
    slider.innerHTML = `<img src="${img}"><img src="${img}" style="filter:brightness(1.1)">`;
    document.getElementById("ppBuyBtn").onclick = () => {
        addCarrinho(nome, preco, img);
        fecharPP();
    };
    document.getElementById("productPage").style.display = "flex";
}

function fecharPP() { document.getElementById("productPage").style.display = "none"; }

function addCarrinho(nome, preco, img) {
    let item = carrinho.find(i => i.nome === nome);
    if(item) item.qtd++; else carrinho.push({nome, preco, img, qtd: 1});
    salvarCarrinhoLocal();
    renderCart();
    showToast(`‚úÖ Adicionado!`);
}

function renderCart() {
    const lista = document.getElementById("listaCarrinho");
    lista.innerHTML = ""; subtotalProdutos = 0;
    carrinho.forEach(item => {
        subtotalProdutos += item.preco * item.qtd;
        lista.innerHTML += `<div class="item-cart"><img src="${item.img}"><div style="flex:1"><div>${item.nome}</div><div>Qtd: ${item.qtd}</div></div><strong>R$ ${(item.preco * item.qtd).toFixed(2)}</strong></div>`;
    });
    document.getElementById("cartCount").innerText = carrinho.reduce((a,b) => a + b.qtd, 0);
    atualizarTotal();
}

function atualizarTotal() {
    const selecionado = document.querySelector('input[name="tipoFrete"]:checked');
    valorFrete = selecionado ? parseFloat(selecionado.dataset.preco || 0) : 0;
    document.getElementById("total").innerText = `R$ ${(subtotalProdutos + valorFrete).toFixed(2).replace('.', ',')}`;
}

function showToast(msg) {
    const t = document.getElementById("toast");
    t.innerText = msg; t.style.display = "block";
    setTimeout(() => { t.style.display = "none"; }, 3000);
}

function toggleCarrinho() {
    const c = document.getElementById("carrinho");
    c.style.right = (c.style.right === "0px") ? "-100%" : "0px";
    document.getElementById("overlay").style.display = (c.style.right === "0px") ? "block" : "none";
}

function buscar(t) {
    t = t.toLowerCase();
    document.querySelectorAll(".produto").forEach(p => p.style.display = p.dataset.name.includes(t) ? "flex" : "none");
}

function filtrarCategoria(el, t) {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active'); buscar(t);
}

function salvarCarrinhoLocal() { localStorage.setItem('idolverse_carrinho_atual', JSON.stringify(carrinho)); }
function carregarCarrinhoLocal() { 
    const salvo = localStorage.getItem('idolverse_carrinho_atual');
    if(salvo) { carrinho = JSON.parse(salvo); renderCart(); }
}
function carregarPedidosHist() { /* Mant√©m l√≥gica anterior */ }
function toggleDesc(btn) { 
    const d = btn.nextElementSibling; d.style.display = d.style.display === "block" ? "none" : "block"; 
}
</script>
</body>
</html>
