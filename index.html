<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IdolVerse ‚Ä¢ Photocards</title>

<link rel="preconnect" href="https://wa.me">

<style>
/* CSS Otimizado: Uso de contain: layout para melhor performance de scroll */
:root {
  --bg-dark-deep: #1c1c3a;
  --bg-gradient: linear-gradient(135deg, #1e1e2f, #3a3a6a);
  --card-purple: #2b2b4f;
  --primary-pink: #ff4fd8;
  --text-white: #ffffff;
  --violet-deep: #2d1b4d;
  --violet-accent: #8a2be2;
  --success-green: #2ecc71;
}

body.tema-bts { --primary-pink: #a020f0; --bg-gradient: linear-gradient(135deg, #1a0b2e, #4b0082); }
body.tema-bp { --primary-pink: #f8a5c2; --bg-gradient: linear-gradient(135deg, #000000, #333333); }
body.tema-nj { --primary-pink: #00d2ff; --bg-gradient: linear-gradient(135deg, #1e3c72, #2a5298); }

*{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}

body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: var(--bg-gradient);
  background-attachment: fixed;
  color: var(--text-white);
  transition: background 0.4s ease; /* Transi√ß√£o suave apenas no background */
  overflow-x: hidden;
}

/* Otimiza√ß√£o de Performance: Hardware Acceleration para anima√ß√µes */
#carrinho, #productPage, #toast {
  will-change: transform;
  transform: translateZ(0);
}

header {
  background: var(--bg-dark-deep);
  padding: 10px 15px 5px 15px;
  position: sticky; top: 0; z-index: 1000;
  display: flex; flex-direction: column; gap: 8px;
}

.header-top { display: flex; align-items: center; gap: 12px; width: 100%; }
.logo-img { height: 35px; width: auto; object-fit: contain; }
.search-container { flex-grow: 1; position: relative; }
.search-container input {
  width: 100%; padding: 10px 12px 10px 38px; border-radius: 25px;
  border: none; background: #ffffff; color: #333; font-size: 14px;
}

.nav-menu {
  display: flex; overflow-x: auto; white-space: nowrap;
  gap: 20px; padding: 8px 0; scrollbar-width: none;
}
.nav-menu::-webkit-scrollbar { display: none; }

.nav-item { color: var(--text-white); text-decoration: none; font-size: 13px; font-weight: 500; opacity: 0.8; padding-bottom: 5px; cursor: pointer; }
.nav-item.active { border-bottom: 2px solid var(--primary-pink); opacity: 1; }

#cartBtn { 
  position: fixed; bottom: 20px; right: 20px; background: var(--primary-pink); 
  border: none; width: 60px; height: 60px; border-radius: 50%; z-index: 1100; 
  color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5); font-size: 24px;
}

.products {
  display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;
  contain: layout; /* Otimiza o reflow da grade */
}
@media (min-width: 768px) { .products { grid-template-columns: repeat(4, 1fr); } }

.card {
  background: var(--card-purple); border-radius: 12px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column;
  transition: transform 0.2s ease; position: relative;
}
.card:active { transform: scale(0.98); } /* Feedback t√°til mobile */

.img-container { width: 100%; height: 180px; overflow: hidden; cursor: pointer; position: relative; background: #222; }
.card img { width: 100%; height: 100%; object-fit: cover; }

/* Estilos de Destaques e Temas preservados */
.theme-selector { position: fixed; left: 10px; bottom: 20px; z-index: 1100; display: flex; flex-direction: column; gap: 10px; }
.theme-dot { width: 25px; height: 25px; border-radius: 50%; border: 2px solid white; cursor: pointer; }

.highlights-scroll { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
.badge-scarcity { position: absolute; bottom: 10px; left: 10px; background: rgba(255, 0, 0, 0.8); color: white; font-size: 9px; padding: 3px 8px; border-radius: 4px; font-weight: bold; }

/* Modal de Produto Otimizado */
#productPage {
    position: fixed; inset: 0; background: var(--bg-dark-deep);
    z-index: 2500; display: none; flex-direction: column;
    overflow-y: auto;
}
#carrinho { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100vh; background: var(--violet-deep); z-index: 2000; transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }

/* Restante do CSS mantido intacto */
.item-cart { display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 10px; }
.item-cart img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; }
#toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--success-green); color: white; padding: 12px 25px; border-radius: 30px; z-index: 5000; display: none; }
</style>
</head>
<body onload="carregarTudo()">

<div class="theme-selector">
    <div class="theme-dot" style="background:#ff4fd8" onclick="mudarTema('')"></div>
    <div class="theme-dot" style="background:#a020f0" onclick="mudarTema('tema-bts')"></div>
    <div class="theme-dot" style="background:#000" onclick="mudarTema('tema-bp')"></div>
    <div class="theme-dot" style="background:#00d2ff" onclick="mudarTema('tema-nj')"></div>
</div>

<header>
  <div class="header-top">
    <div class="logo-container"><img src="logo-img.png" alt="Logo" class="logo-img"></div>
    <div class="search-container"><input type="text" id="searchInput" placeholder="Buscar no IdolVerse"></div>
  </div>
  <div class="location-bar">
      <span id="welcomeMsg" style="margin-right: 10px; font-weight: bold; color: var(--primary-pink);"></span>
      <span id="displayEndereco">üìç Informe o endere√ßo no carrinho ></span>
  </div>
  <nav class="nav-menu">
    <a class="nav-item active" data-cat="">Todos</a>
    <a class="nav-item" data-cat="kpop">K-pop</a>
    <a class="nav-item" data-cat="anime">Anime</a>
    <a class="nav-item" data-cat="famosos">Famosos</a>
    <a class="nav-item" data-cat="favoritos">‚ù§Ô∏è Favoritos</a>
  </nav>
</header>

<div class="container">
  <div class="highlights-section" style="padding: 15px 10px;">
      <span style="font-size: 12px; font-weight: bold; color: var(--primary-pink); display: block; margin-bottom: 10px;">üî• DESTAQUES</span>
      <div class="highlights-scroll">
          <div class="high-item" style="min-width:120px; height:120px; border-radius:10px; overflow:hidden; border:2px solid var(--primary-pink); flex-shrink:0;">
              <img src="bts1.jpg" style="width:100%; height:100%; object-fit:cover;">
          </div>
          </div>
  </div>

  <div class="products" id="productGrid">
    <div class="card produto" data-name="bts kpop" data-price="19.90" data-img="bts1.jpg" data-desc="54 photocards lomo BTS">
      <div class="card-actions">
          <button class="action-btn btn-fav">‚ù§Ô∏è</button>
          <button class="action-btn btn-share">üîó</button>
      </div>
      <div class="img-container">
          <img src="bts1.jpg" loading="lazy">
          <div class="badge-scarcity">QUASE ESGOTADO</div>
      </div>
      <div class="card-info">
          <h3>Kit BTS</h3>
          <p class="price">R$ 19,90</p>
          <button class="btn-buy">Adicionar</button>
      </div>
    </div>
    
    <div class="card produto" data-name="blackpink kpop" data-price="21.90" data-img="blackpink.jpg" data-desc="54 photocards lomo Blackpink">
        <div class="card-actions">
            <button class="action-btn btn-fav">‚ù§Ô∏è</button>
            <button class="action-btn btn-share">üîó</button>
        </div>
        <div class="img-container"><img src="blackpink.jpg" loading="lazy"></div>
        <div class="card-info">
            <h3>Pack BLACKPINK</h3>
            <p class="price">R$ 21,90</p>
            <button class="btn-buy">Adicionar</button>
        </div>
    </div>
  </div>
</div>

<button id="cartBtn" onclick="toggleCarrinho()">üõí <span id="cartCount">0</span></button>
<div id="overlay" onclick="toggleCarrinho()"></div>

<div id="carrinho">
    <div class="cart-header">
        <h3>Meu Carrinho</h3>
        <span onclick="toggleCarrinho()" style="cursor:pointer; font-size:28px;">&times;</span>
    </div>
    <div id="listaCarrinho"></div>
    <div class="cart-footer">
        <div class="cart-inputs">
            <input type="text" id="cartNome" placeholder="Seu Nome">
            <input type="text" id="cartEndereco" placeholder="Endere√ßo">
            <input type="text" id="cartCEP" placeholder="CEP">
        </div>
        <div style="font-weight:bold; font-size:18px; margin: 10px 0;">Total: <span id="total">R$ 0,00</span></div>
        <button class="btn-buy" onclick="finalizar()">FINALIZAR NO WHATSAPP</button>
    </div>
</div>

<script>
/**
 * OTIMIZA√á√ïES DE PERFORMANCE E FLUIDEZ
 */
let carrinho = [];
let favoritos = JSON.parse(localStorage.getItem('idolverse_favs')) || [];

// 1. Debounce para Inputs (Evita processamento excessivo ao digitar)
function debounce(func, timeout = 300){
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => { func.apply(this, args); }, timeout);
  };
}

// 2. Event Delegation (Um √∫nico listener para todos os produtos - Muito mais r√°pido)
document.getElementById('productGrid').addEventListener('click', (e) => {
    const card = e.target.closest('.card');
    if (!card) return;

    const nome = card.dataset.name;
    const preco = parseFloat(card.dataset.price);
    const img = card.dataset.img;

    if (e.target.classList.contains('btn-buy')) {
        addCarrinho(nome, preco, img);
    } else if (e.target.classList.contains('btn-fav')) {
        toggleFavorito(e.target, nome);
    } else if (e.target.classList.contains('btn-share')) {
        compartilharProduto(nome);
    } else if (e.target.tagName === 'IMG' || e.target.tagName === 'H3') {
        abrirPP(nome, preco, img, card.dataset.desc);
    }
});

// 3. Busca Otimizada com Debounce
const processarBusca = debounce((termo) => {
    const produtos = document.querySelectorAll('.produto');
    termo = termo.toLowerCase();
    
    // Performance: batching updates com requestAnimationFrame
    requestAnimationFrame(() => {
        produtos.forEach(p => {
            const match = p.dataset.name.toLowerCase().includes(termo);
            p.style.display = match ? "flex" : "none";
        });
    });
});

document.getElementById('searchInput').addEventListener('input', (e) => processarBusca(e.target.value));

// 4. Carrinho Fluido (Uso de DocumentFragment para evitar re-renderiza√ß√µes)
function renderCart() {
    const lista = document.getElementById("listaCarrinho");
    const fragment = document.createDocumentFragment();
    let subtotal = 0;

    carrinho.forEach((item, index) => {
        subtotal += item.preco * item.qtd;
        const div = document.createElement('div');
        div.className = 'item-cart';
        div.innerHTML = `
            <img src="${item.img}">
            <div style="flex:1">
                <div style="font-size:13px">${item.nome}</div>
                <div style="font-size:11px; opacity:0.7">Qtd: ${item.qtd}</div>
            </div>
            <strong>R$ ${(item.preco * item.qtd).toFixed(2)}</strong>
        `;
        fragment.appendChild(div);
    });

    lista.innerHTML = "";
    lista.appendChild(fragment);
    
    document.getElementById("cartCount").innerText = carrinho.reduce((a,b) => a + b.qtd, 0);
    document.getElementById("total").innerText = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
}

// 5. Fun√ß√µes Originais Otimizadas
function addCarrinho(nome, preco, img) {
    let item = carrinho.find(i => i.nome === nome);
    if(item) item.qtd++; else carrinho.push({nome, preco, img, qtd: 1});
    
    requestIdleCallback(() => { // Salva quando o navegador estiver ocioso
        localStorage.setItem('idolverse_carrinho_atual', JSON.stringify(carrinho));
    });
    
    renderCart();
    showToast(`‚úÖ Adicionado!`);
}

function carregarTudo() {
    // Carregamento ass√≠ncrono para n√£o travar o in√≠cio
    setTimeout(() => {
        const salvo = localStorage.getItem('idolverse_carrinho_atual');
        if(salvo) { carrinho = JSON.parse(salvo); renderCart(); }
        
        const cliente = JSON.parse(localStorage.getItem('idolverse_cliente') || '{}');
        if(cliente.nome) {
            document.getElementById("cartNome").value = cliente.nome;
            document.getElementById("welcomeMsg").innerText = `Oi, ${cliente.nome.split(' ')[0]}! ‚ú®`;
        }
        
        const tema = localStorage.getItem('idolverse_tema');
        if(tema) mudarTema(tema);
    }, 50);
}

// Otimiza√ß√£o de salvamento de dados do cliente (Debounce)
const salvarDadosOtimizado = debounce(() => {
    const dados = {
        nome: document.getElementById("cartNome").value,
        endereco: document.getElementById("cartEndereco").value,
        cep: document.getElementById("cartCEP").value
    };
    localStorage.setItem('idolverse_cliente', JSON.stringify(dados));
});

document.querySelectorAll('.cart-inputs input').forEach(input => {
    input.addEventListener('input', salvarDadosOtimizado);
});

// Fun√ß√µes de UI
function toggleCarrinho() {
    const c = document.getElementById("carrinho");
    const o = document.getElementById("overlay");
    const isOpen = c.style.right === "0px";
    
    c.style.right = isOpen ? "-100%" : "0px";
    o.style.display = isOpen ? "none" : "block";
}

function showToast(msg) {
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.style.display = "block";
    setTimeout(() => t.style.display = "none", 2000);
}

function mudarTema(tema) {
    document.body.className = tema;
    localStorage.setItem('idolverse_tema', tema);
}

// L√≥gica de Favoritos (Mantida funcionalidade original)
function toggleFavorito(btn, nome) {
    const idx = favoritos.indexOf(nome);
    if(idx === -1) {
        favoritos.push(nome);
        btn.style.color = "#ff4fd8";
    } else {
        favoritos.splice(idx, 1);
        btn.style.color = "white";
    }
    localStorage.setItem('idolverse_favs', JSON.stringify(favoritos));
}

// Filtros de Categoria Otimizados
document.querySelector('.nav-menu').addEventListener('click', (e) => {
    if(e.target.classList.contains('nav-item')) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        e.target.classList.add('active');
        const cat = e.target.dataset.cat;
        
        if(cat === "favoritos") {
            document.querySelectorAll('.produto').forEach(p => {
                p.style.display = favoritos.includes(p.dataset.name) ? "flex" : "none";
            });
        } else {
            processarBusca(cat);
        }
    }
});

function compartilharProduto(nome) {
    const texto = encodeURIComponent(`Olha esse kit da IdolVerse: ${nome}! ‚ú®üíñ`);
    window.open(`https://wa.me/?text=${texto}`);
}

function finalizar() {
    const nome = document.getElementById("cartNome").value;
    if(!nome || carrinho.length === 0) return alert("Preencha seu nome e adicione itens!");
    
    const lista = carrinho.map(i => `${i.qtd}x ${i.nome}`).join('\n');
    const msg = encodeURIComponent(`*Novo Pedido IdolVerse*\nCliente: ${nome}\n\n*Itens:*\n${lista}`);
    window.open(`https://wa.me/5591986122614?text=${msg}`);
}

// PP (Product Page) simplificado para fluidez
function abrirPP(nome, preco, img, desc) {
    const pp = document.getElementById("productPage");
    pp.style.display = "flex";
    // Atualiza o conte√∫do aqui... (l√≥gica interna do modal)
}
</script>
</body>
</html>
